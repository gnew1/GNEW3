(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[385],{4688:function(e,t,a){Promise.resolve().then(a.bind(a,3569))},3569:function(e,t,a){"use strict";let s;a.r(t),a.d(t,{default:function(){return x}});var n=a(1804),i=a(8555);function c(e){let{subjectId:t,open:a,onClose:s}=e,[c,l]=(0,i.useState)("v1"),[d,u]=(0,i.useState)({email:{marketing:!1},sms:{notifications:!1},push:{notifications:!1},onchain:{marketing:!1}});(0,i.useEffect)(()=>{a&&fetch("/api/consent/catalog").then(e=>e.json()).then(e=>l(e.matrixVersion))},[a]);let p=async()=>{let e=[];for(let t of(e.push({purposeKey:"growth_marketing",dataCategoryKey:"email",processingUseKey:"marketing",channelKey:"email",state:d.email.marketing?"granted":"denied",policyVersion:c,provenance:"ui_flow"}),["sms","push"]))e.push({purposeKey:"account_access",dataCategoryKey:"phone",processingUseKey:"notifications",channelKey:t,state:d[t].notifications?"granted":"denied",policyVersion:c,provenance:"ui_flow"});e.push({purposeKey:"growth_marketing",dataCategoryKey:"wallet_id",processingUseKey:"marketing",channelKey:"onchain",state:d.onchain.marketing?"granted":"denied",policyVersion:c,provenance:"ui_flow"}),await fetch("/api/consent/".concat(t,"/decisions"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({decisions:e})}),s()};return a?(0,n.jsx)("div",{role:"dialog","aria-modal":!0,className:"fixed inset-0 bg-black/40  z-50 flex items-center justify-center",children:(0,n.jsxs)("div",{className:"bg-white rounded-2xl w-full max-w-xl p-6  space-y-4",children:[(0,n.jsx)("h2",{className:"text-xl font-semibold",children:"Preferencias por canal"}),(0,n.jsx)(r,{title:"Email",children:(0,n.jsx)(o,{label:"Marketing (boletines/ofertas)",checked:d.email.marketing,onChange:e=>u(t=>({...t,email:{...t.email,marketing:e}}))})}),(0,n.jsxs)(r,{title:"SMS / Push",children:[(0,n.jsx)(o,{label:"Notificaciones de seguridad y cuenta",checked:d.sms.notifications,onChange:e=>u(t=>({...t,sms:{notifications:e}}))}),(0,n.jsx)(o,{label:"Notificaciones push en app",checked:d.push.notifications,onChange:e=>u(t=>({...t,push:{notifications:e}}))})]}),(0,n.jsx)(r,{title:"On‑chain",children:(0,n.jsx)(o,{label:"Marketing (airdrops/POAPs)",checked:d.onchain.marketing,onChange:e=>u(t=>({...t,onchain:{marketing:e}}))})}),(0,n.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,n.jsx)("button",{className:"px-4 py-2 border rounded",onClick:s,children:"Cancelar"}),(0,n.jsx)("button",{className:"px-4 py-2 bg-black text-white rounded",onClick:p,children:"Guardar"})]}),(0,n.jsx)("p",{className:"text-xs text-gray-500",children:"Tus cambios quedan auditados y puedes revocar en cualquier momento."})]})}):null}function r(e){let{title:t,children:a}=e;return(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsx)("h3",{className:"font-medium",children:t}),(0,n.jsx)("div",{className:"space-y-2",children:a})]})}function o(e){let{label:t,checked:a,onChange:s}=e;return(0,n.jsxs)("label",{className:"flex items-center justify-between p-3  border rounded-lg",children:[(0,n.jsx)("span",{className:"text-sm",children:t}),(0,n.jsx)("input",{type:"checkbox",checked:a,onChange:e=>s(e.target.checked)})]})}let l=e=>{let t;let a=new Set,s=(e,s)=>{let n="function"==typeof e?e(t):e;if(!Object.is(n,t)){let e=t;t=(null!=s?s:"object"!=typeof n||null===n)?n:Object.assign({},t,n),a.forEach(a=>a(t,e))}},n=()=>t,i={setState:s,getState:n,getInitialState:()=>c,subscribe:e=>(a.add(e),()=>a.delete(e))},c=t=e(s,n,i);return i},d=e=>e?l(e):l,u=e=>e,p=e=>{let t=d(e),a=e=>(function(e,t=u){let a=i.useSyncExternalStore(e.subscribe,i.useCallback(()=>t(e.getState()),[e,t]),i.useCallback(()=>t(e.getInitialState()),[e,t]));return i.useDebugValue(a),a})(t,e);return Object.assign(a,t),a},h=(s=(e,t)=>({loadCatalog:async()=>{let t=await fetch("/api/consent/catalog");e({catalog:await t.json()})},loadState:async t=>{let a=await fetch("/api/consent/".concat(t));e({state:await a.json()})},toggle:(a,s)=>{let n=t().state,i=n.records.find(e=>e.dataCategoryKey===a&&e.processingUseKey===s);i?i.state="granted"===i.state?"denied":"granted":n.records.push({dataCategoryKey:a,processingUseKey:s,state:"granted",policyVersion:t().catalog.matrixVersion}),e({state:{...n}})},save:async e=>{let a={decisions:t().state.records.map(e=>({purposeKey:"user_control",dataCategoryKey:e.dataCategoryKey,processingUseKey:e.processingUseKey,state:e.state,policyVersion:t().catalog.matrixVersion,provenance:"ui_center"}))};await fetch("/api/consent/".concat(e,"/decisions"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)})}}))?p(s):p;function m(e){let{subjectId:t}=e,{loadCatalog:a,loadState:s,catalog:c,state:r,toggle:o,save:l}=h();return((0,i.useEffect)(()=>{a(),s(t)},[t,a,s]),c&&r)?(0,n.jsxs)("div",{className:"space-y-6",children:[(0,n.jsxs)("header",{children:[(0,n.jsx)("h1",{className:"text-2xl font-semibold",children:"Privacy & Consent"}),(0,n.jsx)("p",{className:"text-sm text-gray-500",children:"Control granular por dato/uso. Cambios quedan auditados."})]}),(0,n.jsxs)("table",{className:"w-full border-separate border-spacing-0",children:[(0,n.jsx)("thead",{children:(0,n.jsxs)("tr",{children:[(0,n.jsx)("th",{className:"text-left p-2 sticky top-0 bg-white",children:"Dato \\ Uso"}),c.uses.map(e=>(0,n.jsx)("th",{className:"p-2 text-left",children:e.title},e.key))]})}),(0,n.jsx)("tbody",{children:c.dataCategories.map(e=>(0,n.jsxs)("tr",{className:"border-t",children:[(0,n.jsx)("td",{className:"p-2 font-medium",children:e.title}),c.uses.map(t=>{let a=r.records.find(a=>a.dataCategoryKey===e.key&&a.processingUseKey===t.key),s=(null==a?void 0:a.state)==="granted",i="strictly_necessary"===t.key;return(0,n.jsx)("td",{className:"p-2",children:(0,n.jsxs)("label",{className:"inline-flex items-center gap-2",children:[(0,n.jsx)("input",{"aria-label":"".concat(e.title," → ").concat(t.title),type:"checkbox",checked:s,disabled:i,onChange:()=>o(e.key,t.key)}),(0,n.jsx)("span",{className:"text-sm",children:s?"On":"Off"})]})},t.key)})]},e.key))})]}),(0,n.jsxs)("div",{className:"flex justify-end gap-3",children:[(0,n.jsx)("button",{className:"px-4 py-2 rounded border",onClick:()=>l(t),children:"Guardar"}),(0,n.jsx)("a",{className:"px-4 py-2 rounded border",href:"/api/consent/".concat(t,"/export?fmt=csv"),children:"Descargar CSV"})]})]}):(0,n.jsx)("div",{role:"status","aria-busy":"true",children:"Loading…"})}function x(){let[e,t]=(0,i.useState)(!1),a="demo_subject";return(0,n.jsxs)("div",{className:"p-6 space-y-6",children:[(0,n.jsx)("h1",{className:"text-2xl font-semibold",children:"Privacidad y Consentimiento"}),(0,n.jsx)("p",{className:"text-sm text-gray-600",children:"Gestiona por finalidad y canal. Descarga un recibo o revoca."}),(0,n.jsx)("button",{className:"px-4 py-2 border rounded",onClick:()=>t(!0),children:"Gestionar por canal"}),(0,n.jsx)(m,{subjectId:a}),(0,n.jsx)(c,{subjectId:a,open:e,onClose:()=>t(!1)})]})}}},function(e){e.O(0,[239,299,744],function(){return e(e.s=4688)}),_N_E=e.O()}]);