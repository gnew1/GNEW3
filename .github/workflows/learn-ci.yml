name: Learn Content CI
on:
  pull_request:
    paths: ["apps/web/content/**", "apps/web/src/modules/learn/**", "tools/**", ".github/workflows/learn-ci.yml"]
  push:
    branches: [main]
    paths: ["apps/web/content/**", "tools/**"]

jobs:
  validate-index:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-node@v4
        with: { node-version: 20 }
      - name: Install deps
        run: |
          pnpm i
      - name: Validate freshness
        run: pnpm tsx tools/validate-content.ts
      - name: Build semantic index
        run: pnpm tsx tools/build-embedding-index.ts

 
Pruebas / DoD (Definition of Done)
â—	âœ… Biblioteca visible en /learn con filtros por rol, bÃºsqueda semÃ¡ntica y metadatos (version, lastReviewed).

â—	âœ… Rutas de aprendizaje por rol en /learn/path/:role.

â—	âœ… Plantillas MDX con quizzes, vÃ­deo y callouts; progreso guardado (SCORM lite), skip/retomar natural.

â—	âœ… Tracking Amplitude de inicio â†’ finalizaciÃ³n, satisfacciÃ³n (1â€“5).

â—	âœ… On chain opcional: botÃ³n de insignia soulbound (mint controlado por relayer/rol MINTER_ROLE).

â—	âœ… Contenidos al dÃ­a: validaciÃ³n de lastReviewed en CI; Ã­ndice semÃ¡ntico generado en cada PR.

â—	ğŸ¯ KPIs: tasa de finalizaciÃ³n â‰¥ X%, satisfacciÃ³n â‰¥ Y/5 (configurar metas exactas).

 
Riesgos & Controles
â—	DesactualizaciÃ³n â†’ Control: tools/validate-content.ts + campo lastReviewed; PRs bloquean si >90 dÃ­as.

â—	Sobrecarga cognitiva â†’ Control: vÃ­deos < 90s, secciones cortas, quizzes de 1â€“3 preguntas.

â—	Baja conversiÃ³n â†’ Control: A/B por feature flags (activar/desactivar quizzes, orden), re engagement desde /onboarding (email/push).

â—	Privacidad â†’ Control: no PII en localStorage (solo estado de tutorial); analÃ­tica con IDs seudÃ³nimos.

â—	Abuso de badges â†’ Control: claim vÃ­a backend/relayer con MINTER_ROLE; validaciÃ³n de score/slug y anti replay.

 
Â¿Te agrego ahora un tercer tutorial MDX por rol â€œvalidatorâ€ y el hls.js opcional para streams .m3u8? Puedo incluirlos en el mismo formato.
TÃº dijiste:
programa a nivel de detalle para gnew N55 6.5 GamificaciÃ³n (Prompt 55) Objetivo: Puntos, niveles y logros no-especulativos para motivar. Roles: Producto, Frontend, Backend, Legal. Stack: MÃ³dulo badges (soulbound), tabla de misiones, anti-abuso. Entregables: CatÃ¡logo de logros, reglas transparentes, perfiles pÃºblicos. Pasos: Definir economÃ­a blanda (no convertible) y antigrind. Integrar con onboarding y gobernanza (misiones Ãºtiles). ModeraciÃ³n automÃ¡tica (detecciÃ³n de farming). Pruebas / DoD: RetenciÃ³n +Î”, sin incentivos perversos. Riesgos & Controles: DesalineaciÃ³n â†’ comitÃ© de diseÃ±o; abuso â†’ lÃ­mites diarios.
ChatGPT Plus
PensÃ³ durante 37s
Ruta completa: .\docs\programas\N55-gamificacion.md
GNEW N55 â€” 6.5 GamificaciÃ³n (Prompt 55)
Objetivo
DiseÃ±ar e implementar un sistema de puntos, niveles y logros no especulativos que incremente la motivaciÃ³n intrÃ­nseca y la participaciÃ³n Ãºtil en GNEW, sin crear incentivos financieros ni dinÃ¡micas de â€œgrindâ€. La gamificaciÃ³n debe alinearse con onboarding, gobernanza y calidad de contribuciones, respetando GDPR by design y accesibilidad.
Roles responsables
â—	Producto (owner): visiÃ³n, catÃ¡logo de logros, reglas y KPIs.

â—	Frontend: UI/UX de perfiles, progreso, toasts/badges, checklist y pÃ¡ginas pÃºblicas.

â—	Backend: APIs, motor de reglas, antifraude, almacenamiento y eventos.

â—	Legal & Privacidad: revisiÃ³n de reglas, textos y tratamiento de datos.

â—	Data/ML (apoyo): scoring antigrind/farming y mÃ©tricas de impacto.

â—	Accesibilidad: validaciÃ³n WCAG 2.2 AA en UI gamificada.

â—	QA: pruebas funcionales, visuales y E2E.

Stack & convenciones
â—	Frontend: React 18 + Vite, TypeScript, Zustand/Redux Toolkit, React Query, React Router, i18n. Storybook + Playwright (regresiÃ³n visual). ESLint/Prettier.

â—	Backend: Node.js (Express/Fastify) o FastAPI donde aplique, OpenTelemetry â†’ Prometheus/Grafana, PostgreSQL/SQLModel, Redis para rate limits/contadores, NATS para eventos (si estÃ¡ habilitado).

â—	On chain (opcional): CosmWasm mÃ³dulo soulbound badges (no transferibles) gatillados por eventos verificados.

â—	Antiabuso: lÃ­mites diarios/por evento, detecciÃ³n de anomalÃ­as (z scores/percentiles), moderaciÃ³n automÃ¡tica y colas de revisiÃ³n humana.

â—	Seguridad SC: OpenZeppelin like patterns, checks effects interactions, custom errors (si aplica a contratos).

â—	IntegraciÃ³n global (obligatoria):

â—‹	Repo: main protegido; GitFlow; PRs con checks (lint, unit, security).

â—‹	CI/CD: GitHub Actions matriz (node/solc), deploy gated por Seguridad + Gobernanza.

â—‹	Secrets: OIDC + Vault (services/common/vault.*), nada de claves en repos.

â—‹	Docs: Docusaurus con secciones â€œArquitecturaâ€, â€œContratosâ€, â€œAPIsâ€, â€œRunbooksâ€.

â—‹	Observabilidad: trazas por request/tx (OTel), dashboards en Grafana.

â—‹	Accesibilidad & i18n: desde el primer sprint.

â—‹	Legal & privacidad: GDPR by design, minimizaciÃ³n y seudonimizaciÃ³n.

â—‹	DoD genÃ©rico: cÃ³digo + tests + docs + dashboards + playbooks; demo reproducible en entorno limpio.

Entregables
1.	CatÃ¡logo de logros y misiones

â—‹	Tipos: participaciÃ³n Ãºtil, calidad (peer review), gobernanza (propuestas/votos), contribuciones tÃ©cnicas (PRs, issues), aprendizaje (tutoriales).

â—‹	Reglas transparentes por logro (criterios, cooldowns, lÃ­mites diarios).

2.	EconomÃ­a blanda (no convertible)

â—‹	Puntos (soft currency), Niveles, Rachas (streaks) con antigrind.

3.	MÃ³dulo de Badges (soulbound)

â—‹	Contrato CosmWasm opcional para logros clave (no transferibles).

â—‹	Espejo off chain para consulta rÃ¡pida y privacidad.

4.	Perfiles pÃºblicos con privacidad granular (opt in), vitrina de logros y progreso.

5.	APIs (/v1/gamification/*) y SDK (frontend) para consultar/progresar.

6.	Motor de reglas (event driven) con antifraude y auditorÃ­a.

7.	IntegraciÃ³n con Onboarding y Gobernanza

â—‹	Misiones â€œÃºtilesâ€ conectadas a flujos reales (e.g., revisar una propuesta).

8.	Dashboards (mÃ©tricas de retenciÃ³n, conversiÃ³n, abuso) y Runbooks.

Pasos clave
1.	Descubrimiento & alineaciÃ³n (Producto + Legal + Accesibilidad)

â—‹	Definir KPIs: retenciÃ³n D30, DAU/WAU, % conversiÃ³n onboardingâ†’actividad, calidad (ratio PRs merged, votos vÃ¡lidos).

â—‹	Mapa de riesgos (perversos incentivos, spam, privacidad).

2.	DiseÃ±o de la economÃ­a blanda

â—‹	Tabla de recompensas por evento, decreciente por repeticiÃ³n, cooldowns y lÃ­mites diarios.

â—‹	Antigrind: funciÃ³n de utilidad cÃ³ncava (p.ej., reward = base * 1/âˆš(1+rep_evento_dia)).

3.	Modelo de datos (PostgreSQL)

â—‹	users(id, â€¦)

â—‹	events(id, user_id, kind, meta, ts)

â—‹	rules(id, kind, expr_json, cooldown_s, daily_cap, weight)

â—‹	points_ledger(id, user_id, delta, reason, ts, source_event_id, reviewer_id)

â—‹	levels(user_id, level, xp, ts)

â—‹	badges(id, code, title, sbt, criteria_json)

â—‹	user_badges(user_id, badge_id, ts, onchain_tx_hash?, visibility)

â—‹	abuse_flags(id, user_id, reason, score, ts)

â—‹	Ãndices por user_id, kind, ts; auditorÃ­a append only en points_ledger.

4.	Motor de reglas (event driven)

â—‹	Consumir eventos (NATS/Kafka opcional): onboarding, PR merged, voto, tutorial completado.

â—‹	EvaluaciÃ³n idempotente (hash de evento + regla), transacciones atÃ³micas y tracing (OTel).

5.	MÃ³dulo antifraude

â—‹	Rate limits por kind/user (Redis).

â—‹	HeurÃ­sticas: Co ocurrencias sospechosas, repeticiÃ³n mecÃ¡nica, umbral de similitud en contribuciones.

â—‹	Marcado para revisiÃ³n humana y shadow penalties (no otorgar puntos hasta validaciÃ³n).

6.	Badges soulbound (opcional pero recomendado)

â—‹	Contrato CosmWasm no transferible (roles minter=backend).

â—‹	ClÃ¡usulas de privacidad: opt in, posibilidad de ocultar en perfil aunque emitido on chain.

7.	Frontend

â—‹	Kit de componentes: ProgressRing, Badge, AchievementCard, Streak, LevelPill.

â—‹	PÃ¡ginas: Perfil pÃºblico, Mis logros, Misiones (lista + detalle), Reglas (transparencia).

â—‹	i18n (plural rules), a11y (navegaciÃ³n teclado, contrastes, ARIA).

8.	IntegraciÃ³n con Onboarding y Gobernanza

â—‹	Misiones iniciales con valor real (vincular tutoriales/micro learning N54 y onboarding N53).

â—‹	Deep links a acciones (web/mÃ³vil RN).

9.	Observabilidad & Datos

â—‹	MÃ©tricas: gamification_points_awarded_total, abuse_flags_total, daily_active_questers, streak_breaks_total.

â—‹	Dashboards Grafana + trazas por evaluaciÃ³n de reglas.

10.	Docs & Playbooks

â—	Docusaurus: Arquitectura, APIs, catÃ¡logo de logros, â€œHow to add a ruleâ€, Runbook antifraude.

Pruebas / DoD
â—	Lighthouse â‰¥ 90 (a11y/PWA) en pÃ¡ginas gamificadas.

â—	Cobertura > 80% (unit + integration + E2E Playwright/Detox mÃ³vil).

â—	RegresiÃ³n visual en Storybook (chromatic/Playwright).

â—	Seguridad: SAST/DAST, zero high/critical pendientes; contratos con slither/echidna si aplica.

â—	Carga: p95 < 200â€¯ms para /v1/gamification/* (cache/indices).

â—	Antiabuso: tests de lÃ­mites, idempotencia, colisiones, replay.

â—	Privacidad: tests de seudonimizaciÃ³n y controles de visibilidad.

â—	Observabilidad: mÃ©tricas y trazas visibles en Grafana; alertas en Prometheus.

â—	Entrega: cÃ³digo + tests + docs + dashboards + runbooks; demo reproducible.

Riesgos & Controles
â—	DesalineaciÃ³n de incentivos â†’ ComitÃ© de diseÃ±o (Producto + Legal + Comunidad) con revisiones quincenales; reglas versionadas y pÃºblicas.

â—	Farming/abuso â†’ lÃ­mites diarios, shadow penalties, colas de revisiÃ³n, detecciÃ³n de anomalÃ­as y baneo escalonado.

â—	Sobrecarga cognitiva â†’ micro tareas y feedback claro; opciones de silenciar toasts.

â—	Privacidad â†’ opt in para perfil pÃºblico y badges on chain; datos mÃ­nimos y seudÃ³nimos.

â—	Riesgos legales â†’ sin canje ni equivalencia econÃ³mica; textos de tÃ©rminos revisados por Legal.

 
API (borrador)
POST /v1/gamification/events
Registra un evento user action.
{ "userId": "alice", "kind": "vote_cast", "meta": { "proposalId": "p123" }, "ts": "ISO-8601" }

201 â†’ evalÃºa reglas, otorga puntos/logros de forma idempotente.
GET /v1/gamification/progress/:userId
Devuelve puntos, nivel, racha y Ãºltimos logros.
GET /v1/gamification/badges/:userId?public=true
Lista badges (filtrables por visibilidad).
POST /v1/gamification/mint-badge (si on chain)
Solo backend con rol minter. Body: { userId, badgeCode }.
 
Esquema de reglas (ejemplos)
{
  "code": "VOTE_QUALITY",
  "kind": "vote_cast",
  "criteria": { "minProposalAgeHours": 24, "uniquePerProposal": true },
  "reward": { "points": 5, "cooldown_s": 3600, "daily_cap": 15 },
  "anti_grind": { "decay": "sqrt" },
  "audit": true
}

 
Contrato SBT (CosmWasm) â€” interfaz mÃ­nima (opcional)
â—	mint_sbt { to, badge_code } (solo minter)

â—	revoke_sbt { token_id } (para fraude comprobado)

â—	query: { sbt_of { address } }

â—	No transfer implementado; metadatos con criteria_uri.

 
MÃ©tricas (Prometheus)
â—	gam_points_awarded_total{kind, rule_code}

â—	gam_badges_minted_total{badge_code}

â—	gam_abuse_flags_total{reason}

â—	gam_rule_eval_duration_seconds (histograma)

â—	service_info{service_name="gamification",environment}

 
Plan de sprints (8â€“10 semanas)
â—	S1: CatÃ¡logo de logros, KPIs, riesgos, esquema datos.

â—	S2: Motor de reglas + eventos + idempotencia + mÃ©tricas.

â—	S3: Antiabuso (rate limit, heurÃ­sticas) + auditorÃ­a.

â—	S4: UI (perfil, logros, misiones) + i18n + a11y.

â—	S5: IntegraciÃ³n con Onboarding (N53) y Tutoriales (N54).

â—	S6: SBT opcional + perfiles pÃºblicos + privacidad granular.

â—	S7: Observabilidad completa + dashboards + runbooks.

â—	S8: Hardening, carga, seguridad, beta pÃºblica.

 
CI/CD y gobernanza tÃ©cnica
â—	GitHub Actions: matrices node/solc; jobs: installâ†’lintâ†’testâ†’buildâ†’sec (SAST, dep audit)â†’e2eâ†’container scan.

â—	Gates: aprobaciÃ³n Seguridad + Gobernanza para producciÃ³n.

â—	Secrets: OIDC a Vault; prohibido .env en repo.

â—	Artefactos: imÃ¡genes con etiqueta git sha + semver; SBOM adjunto.

 
Runbooks (resumen)
â—	â€œAÃ±adir una regla nuevaâ€: editar rules (Docusaurus guÃ­a), crear test de idempotencia, actualizar Storybook con caso de UI.

â—	â€œInvestigar sospecha de farmingâ€: consultar dashboard abuse_flags, extraer points_ledger por user, aplicar checklist de revisiÃ³n, usar endpoint de revocaciÃ³n si SBT.

 
KPIs & Ã©xito
â—	RetenciÃ³n: Î”â‰¥ X pp vs. baseline (definir X con Data).

â—	ConversiÃ³n onboardingâ†’actividad: â‰¥ X%.

â—	Incidentes por abuso: tendencia decreciente semana a semana.

â—	SatisfacciÃ³n (encuesta in product): â‰¥ Y/5.

Nota: Todos los parÃ¡metros X/Y quedan fijados por Producto/Data antes de S1 y documentados en Docusaurus.
 
Fin del programa N55.
TÃº dijiste:
programa a nivel de detalle lo anterior
ChatGPT Plus
PensÃ³ durante 55s
Perfecto. AquÃ­ tienes el programa a nivel de detalle y entrega para GNEW Â· N55 â€” 6.5 GamificaciÃ³n (Prompt 55), con rutas completas y cÃ³digo listo para backend (Node/TS + Postgres + Redis), frontend (React 18 + Vite/TS), reglas transparentes, mÃ³dulo anti abuso, perfiles pÃºblicos, catÃ¡logo de logros y soporte opcional de badges soulbound (Solidity, rol minter en backend). Cumple los lineamientos globales (GitFlow, CI/CD, OIDC, observabilidad, a11y, GDPR).
 
Back end Â· Servicio â€œgamificationâ€
Estructura
services/gamification/
  package.json
  tsconfig.json
  src/
    index.ts
    env.ts
    db.ts
    redis.ts
    otel.ts
    schema.ts
    rules.ts
    engine.ts
    moderation.ts
    routes/
      events.ts
      progress.ts
      catalog.ts
      profile.ts
      badges.ts
  migrations/
    001_init.sql
    002_seed_rules.sql
